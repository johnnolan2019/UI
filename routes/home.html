<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <style>
        body {font-family: Arial;}

        /* Style the tab */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }

        /* Style the buttons inside the tab */
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 17px;
        }

        /* Change background color of buttons on hover */
        .tab button:hover {
            background-color: #ddd;
        }

        /* Create an active/current tablink class */
        .tab button.active {
            background-color: #ccc;
        }

        /* Style the tab content */
        .tabcontent {
            display: none;
            padding: 6px 12px;
            -webkit-animation: fadeEffect 1s;
            animation: fadeEffect 1s;
        }

        /* Fade in tabs */
        @-webkit-keyframes fadeEffect {
            from {opacity: 0;}
            to {opacity: 1;}
        }

        @keyframes fadeEffect {
            from {opacity: 0;}
            to {opacity: 1;}
        }
    </style>
</head>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript" language="javascript">
    let logHeaders = ["UID", "Text"];
    let uidHeaders = ["UID"];

    $(document).ready(function () {
        hideAll();
    });
    function getLogs(){
        $.ajax({

            url: "/getAll",
            success: [function (data) {
                displayLog(data);
            }],
            error: [function () {
                console.log("Error");
            }]
        });
    }

    function displayLog(data) {
        data = JSON.parse(data);
        let out = "<h2>Logs</h2><table border=1 width=100%>";
        let i;
        out += '<tr style="font-size: 20px;" >';
        for (i = 0; i < logHeaders.length; i++) {
            out += '<th >' + logHeaders[i] + '</th>';
        }
        out += "</tr>";

        for (i = 0; i < data.length; i++) {
            out += "<tr>";
            out += '<td >' + data[i].uid + '</td>';
            out += '<td >' + data[i].text + '</td>';
            out += "</tr>";
        }

        out += "</table>";
        out += "<br>";
        out += "</table>";
        document.getElementById("data").innerHTML = out;
        hideAll();
        $("#data").show();
    }

    function getUid(){
        $.ajax({

            url: "/getUid",
            success: [function (data) {
                displayUid(data);
            }],
            error: [function () {
                console.log("Error");
            }]
        });
    }

    function displayUid(data){
        data = JSON.parse(data);
        let out = "<h2>Logs</h2><table border=1 width=100%>";
        let i;
        out += '<tr style="font-size: 20px;" >';
        for (i = 0; i < uidHeaders.length; i++) {
            out += '<th >' + uidHeaders[i] + '</th>';
        }
        out += "</tr>";

        for (i = 0; i < data.length; i++) {
            out += "<tr>";
            out += '<td >' + data[i].uid + '</td>';
            out += "</tr>";
        }

        out += "</table>";
        out += "<br>";
        out += "</table>";
        document.getElementById("uid").innerHTML = out;
        hideAll();
        $("#uid").show();
    }

    function hideAll() {
        $("#add").hide();
        $("#data").hide();
        $("#uid").hide();
    }

    function listUid(){
        hideAll();
        getUid();
    }

    function showInstaller(){
        hideAll();
        $("#add").show();
    }

    function subscribe(body) {
        console.log(body.channel);
        console.log(body.uid);
        body = JSON.stringify(body);
        $.ajax({
            type: "POST",
            contentType: 'application/json',
            data: body,
            url: "/subscribe",
            success: [function (data) {
               console.log("Success");
            }],
            error: [function () {
                console.log("Error");
            }]
        });
    }

    $(document).ready(function () {
        $("#add").on("submit", function (event) {
            event.preventDefault();
            let data = $('#installer').serializeArray();
            let body = {};
            $.each(data, function() {
                if (body[this.name] !== undefined) {
                    if (!body[this.name].push) {
                        body[this.name] = [body[this.name]];
                    }
                    body[this.name].push(this.value || '');
                } else {
                    body[this.name] = this.value || '';
                }
            });

            subscribe(body);

        });
    });

</script>
<body >
<!-- Tab links -->
    <div class="tab">
        <button class="tablinks" onclick="hideAll()">Home</button>
        <button class="tablinks" onclick="getLogs()">Show All</button>
        <button class="tablinks" onclick="listUid()">Analyse</button>
        <button class="tablinks" onclick="showInstaller()">Add</button>
    </div>
    <div id="data"></div>
    <div id="uid"></div>
    <div id="add">
        <h2>Add system</h2>
        <p>
        <form id="installer" action="">
            Uid:<br>
            <input type="text" name="uid" value="">
            <br>
            Channel:<br>
            <input type="text" name="channel" value="">
            <br>
            <br>
            <input type="submit">
        </form>
    </div>
    <!--<div class="menu">
        <ul class="menu-options">
            <li class="menu-option">Add Note</li>
        </ul>
    </div>-->

</body>

</html>